
<mat-card class="app-card">

  <mat-toolbar class="app-toolbar" style="padding: 0 !important;">
    <div mat-card-avatar style="margin:0px;margin-right: 50px" (click)="addImage()">
      <img *ngIf="new_shop.picture?.length==0" [src]="config.values.icon_card_shop" style="padding:0px;width:75px;">
      <app-visual *ngIf="new_shop.picture?.length>0" size="75" [picture]="new_shop.picture" ></app-visual>
    </div>

    <div style="display:inline-block;margin-top:20px;">
      <h2>
        <span *ngIf="new_shop.name?.length<=3">Votre établissement</span>
        <span *ngIf="new_shop.name?.length>3">{{new_shop.name}}</span>
      </h2>
      <small style="color:lightgrey;">
        Les promotions sont liées à l'établissement.
        <br>Le nom peut être le vôtre (indépendant, artisant) </small>
    </div>

    <span class="spacer"></span>
    <button mat-button mat-flat-button mat-icon-button
            id="btnValide" *ngIf="new_shop.name?.length>0"
            class="app-button" (click)="add()">
      <mat-icon>checkmark</mat-icon>

    </button>
  </mat-toolbar>

  <mat-card-content class="app-card-content">
    <br><br>
    <app-tuto label="Avant de pouvoir créer une promotion, vous devez créer l'enseigne qui va faire l'offre"></app-tuto>

    <mat-form-field class="form-field-style" style="width:75%;margin-right:10px;">
      <input id="txtShopName" type="text"
             (focus)="focusElt=='shopname'"
             (keyup)="canUpdateName=false"
             data-tac="On Commence par indiquer le nom de l'enseigne qui va faire la promotion"
             matInput placeholder="Nom de votre établissement ou juste votre nom" [(ngModel)]="new_shop.name" autofocus>
    </mat-form-field>
    <button *ngIf="map!=null" mat-button mat-flat-button mat-icon-button (click)="localize()">
      <mat-icon>gps_fixed</mat-icon>
    </button>

    <br>

    <mat-form-field class="form-field-style">
      <input id="txtShopAddress" type="text"
             (focus)="focusElt=='address'"
             data-tac="Puis on indique l'adresse de l'enseigne ou l'on pourra récupérer la promotion et l'utiliser"
             matInput placeholder="Adresse de l'enseigne ou l'on peut récupérer la promotion" [(ngModel)]="new_shop.address"
             (change)="showOnMap()">
      <button mat-button *ngIf="new_shop.address" matSuffix mat-icon-button aria-label="Clear" (click)="new_shop.address=''">
        <mat-icon>close</mat-icon>
      </button>
    </mat-form-field>
    <br>

    <!--<mat-label *ngIf="show_address" style="font-size: x-small;color:lightgrey;">Adresse interprétée: {{show_address}}</mat-label>-->

    <div id="map" class="map form-field-style"
         (mouseup)="reverseGeocode=true"
         (touchend)="reverseGeocode=true">
    </div>

    <app-tuto [delay]="5" *ngIf="focusElt=='address'"
              label="Vérifier la localisation de votre enseigne sur la carte avant validation"></app-tuto>

    <br>

    <mat-checkbox [(ngModel)]="new_shop.public" id="chkPublic"
                  title="On souhaite que les promotions de cette enseigne soit visible de tous via la carte"
                  (change)="checkLogin()">
      Rendre la promotion public (visible sur la carte)
    </mat-checkbox>
    <br>

    <br>
    <mat-form-field class="form-field-style" style="width:70%;" (focus)="focusElt='tags'">
      <mat-label>Type d'établissement</mat-label>
      <mat-select id="txtShopTags"
                  title="Ici on peut qualifier le type d'établissement. Cela permettra une préselection des modèles de promotions"
                  [(ngModel)]="new_shop.tags"  multiple>
        <mat-option *ngFor="let tag of config.values.tags?.split(',')" [value]="tag">#{{tag}}</mat-option>
      </mat-select>
    </mat-form-field>

    <app-tuto [delay]="10" *ngIf="focusElt=='tags'"
              label="Les tags sont très utiles pour filtrer les modèles de coupon en fonction du type d'enseigne"></app-tuto>

    &nbsp;&nbsp;

    <button mat-flat-button mat-button
            id="cmdFile"
            (click)="addImage()"
            >
      Visuel
    </button>

    <br>
    <mat-form-field class="form-field-style">
      <input id="txtWebsite" type="text"
             (focus)="focusElt=='website'"
             title="Indiquer le site web ou un lien pour en savoir plus, celui-ci sera visible sur les coupons."
             matInput placeholder="Site web / En savoir plus" [(ngModel)]="new_shop.website">
    </mat-form-field>
    <br>

  </mat-card-content>

  <mat-card-actions class="app-card-action">

    <button mat-button mat-flat-button
            title="La validation entraine l'ajout de l'enseigne dans la liste de vos établissements"
            id="btnValide2" *ngIf="new_shop.name?.length>0"
            class="app-button" (click)="add()">Valider</button>

    <button mat-button mat-flat-button
            id="btnCancel"
            class="app-button"
            (click)="cancel()">
      Annuler
    </button>
    &nbsp;

  </mat-card-actions>
</mat-card>
