<mat-expansion-panel *ngFor="let shop of user.shops" class="app-card" [expanded]="shop.visible" style="margin-bottom: 3px;margin-top:3px;">
  <mat-expansion-panel-header collapsedHeight="80px" expandedHeight="75px"
                              name="shopCard"
                              class="app-card-header"
                              (click)="shop.visible=!shop.visible">

    <img *ngIf="shop.picture?.length==0" [src]="config.values.icon_card_shop" style="width:75px;height:75px;">
    <app-visual *ngIf="shop.picture?.length>0" [picture]="shop.picture" width="75px" height="75px"></app-visual>

    <span class="app-card-title">{{shop.name}}</span>

    <div class="app-card-subtitle">
      <span *ngIf="shop.followers?.length>0">
        Vous avez {{shop.followers?.length}} followers
      </span>
    </div>

  </mat-expansion-panel-header>


  <div class="app-card-content" name="shopContent">
    <div id="print-section-{{shop._id}}" style="display: none;">
      <app-print-coupon [shop]="shop"></app-print-coupon>
    </div>


    <br>
    <app-list-coupons [coupons]="shop.coupons"
                      [user]="user"
                      (delete)="onupdate.emit($event)"
                      (update)="onupdate.emit($event)"
                      (edit)="edit(shop,$event)">
    </app-list-coupons>


    <app-tuto *ngIf="shop.coupons?.length>0 && user.level<1"
              color="white"
              type="title"
              background="./assets/img/feudartifice2.jpg"
              title="Bravo, votre première promotion est prête!"
              subtitle="faites le savoir, Imprimez une première affiche ou partager la"
    >
    </app-tuto>


  </div>

  <app-scanner [size]="300"
               *ngIf="showWebCam && shop.visible"
               [filter]=""
               (flash)="onFlash_event($event,shop)">
  </app-scanner>


  <mat-action-row class="app-card-action">

    <button mat-button name="btnDelegate"
            (click)="setDelegate(shop)"
            *ngIf="user.level>0.5"
            title="Déléguer l'encaissement"
            mat-flat-button mat-icon-button>
      <mat-icon>person_add</mat-icon>
    </button>


    <button mat-button name="btnPrint"
            (click)="openPrinter(shop)"
            *ngIf="user.level>0.7"
            ngxClipboard [cbContent]="shop.url"
            title="Imprimer le QRCode de l'enseigne"
            mat-flat-button mat-icon-button>
      <mat-icon>printer</mat-icon>
    </button>

    <button mat-button mat-flat-button mat-icon-button
            *ngIf="shop.coupons?.length==0"
            title="Supprimez l'enseigne de votre compte"
            (click)="delShop(shop)">
      <mat-icon>delete</mat-icon>
    </button>

    <button mat-button mat-flat-button mat-icon-button
            *ngIf="user.level>0.8"
            title="Graph de diffusion d'une promo"
            (click)="openGraph(shop._id)">
      <mat-icon>link</mat-icon>
    </button>

    <button mat-button mat-flat-button mat-icon-button
            name="btnNewPromoAdvanced"
            *ngIf="user.level>=1"
            title="Nouvelle promotion attachée à cette enseigne"
            (click)="addCoupon(shop,'')">
      <mat-icon>note_add</mat-icon>
    </button>

    <button mat-button mat-flat-button
            name="btnNewPromo"
            *ngIf="user.level<1"
            data-tac="La création d'une enseigne se fait depuis la zone de profil"
            title="Nouvelle promotion attachée à cette enseigne"
            (click)="addCoupon(shop,'')">
      <mat-icon>add_circle</mat-icon>&nbsp;&nbsp;Promotion
    </button>

  </mat-action-row>

</mat-expansion-panel>

