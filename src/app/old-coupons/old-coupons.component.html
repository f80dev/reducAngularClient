<mat-card class="app-card" style="background: none;">
  <mat-toolbar class="app-toolbar">
    <div style="display: inline-block;padding:0px;vertical-align: text-top;" *ngIf="!askFilter">
      {{title}}<br>
      <span style="font-size: small;color: lightgray;">{{subtitle}}</span>
    </div>

    <div style="width:80%;display: inline-block;" *ngIf="askFilter">
      Pour quelle type de points de vente<br> souhaitez-vous voir des modèles ?
    </div>

    <span class="spacer">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </span>
    <button mat-button mat-icon-button
            *ngIf="filter?.length==0 && withFilter"
            (click)="changeFilter()" >
      <mat-icon>recycle</mat-icon>
    </button>
    <button mat-button mat-flat-button mat-icon-button *ngIf="filter?.length>0 && !withFilter" (click)="opereFilter()">
      <mat-icon>filter_list</mat-icon>
    </button>
    &nbsp;
    &nbsp;
    <button class="small-button"
            *ngIf="!askFilter"
            mat-icon-button mat-button mat-flat-button
            (click)="oncancel.emit()">
      <mat-icon>close</mat-icon>
    </button>

    <button mat-button mat-icon-button mat-raised-button
            title="Valide"
            id="btnValideFilter"
            *ngIf="askFilter && selTags?.length>0"
            (click)="selFilter()">
      <mat-icon>checkmark</mat-icon>
    </button>

    <button mat-button mat-raised-button
            title="Valide"
            id="btnValideFilterAll"
            *ngIf="askFilter && selTags?.length==0"
            (click)="selFilter()">
      Tout voir
    </button>
  </mat-toolbar>


  <span *ngIf="withFilter" style="font-size: small;margin-left:15px;">
    Filtre actif : {{filter}}
    <button mat-button
            title="Vous pouvez désactiver le filtre pour voir l'ensemble des modèles disponibles"
            id="btnClearFilter"
            mat-icon-button
            (click)="refresh()">
      <mat-icon>cancel</mat-icon>
    </button>
  </span>


  <!--Sélection d'un filtre-->
  <mat-card-content class="app-card-content" *ngIf="askFilter">

    <mat-selection-list #tags (selectionChange)="selTags=tags?.selectedOptions.selected">
      <mat-list-option *ngFor="let tag of config.values.tags?.split(',')">
        {{tag}}
      </mat-list-option>
    </mat-selection-list>
  </mat-card-content>



  <mat-card-content class="app-card-content" *ngIf="!askFilter">
    <app-tuto label="Les modèles ne sont qu'une base. Ils sont entièrement modifiables pour s'adapter à votre promotion"
              *ngIf="coupons.length>0">
    </app-tuto>
    <mat-list style="padding:0px;">
      <mat-list-item *ngFor="let coupon of coupons | orderBy:'score':'desc' " name="coupon" (click)="onselect.emit(coupon)" style="cursor: pointer;">
        <img *ngIf="coupon.picture" matListAvatar [src]="coupon.picture">
        <h2 matLine (click)="onselect.emit(coupon)">
          <span *ngIf="coupon.title">{{coupon.title}}</span>
          <span *ngIf="!coupon.title">
        {{coupon.label}} sur {{coupon.unity}}
      </span>
        </h2>
        <p matLine style="margin-top: 0px; font-size: small;">
          <!--<span *ngIf="coupon.max>0">Gagner jusqu'à {{coupon.max}}{{coupon.symbol}}</span>-->
          <!--<span *ngIf="coupon.max==0">Gagner {{coupon.final_bonus}}{{coupon.symbol}}</span>-->
          {{coupon.conditions}}
        </p>
        <p matLine style="margin-top: 10px;"  *ngIf="coupon.share">
          <span> Distribution:{{coupon.share}} </span>
        </p>
        <!--<p matLine style="font-size: small;margin-top:5px;">-->
          <!--<span> Partage: {{coupon.share_bonus}}{{coupon.symbol}} / Immédiat: {{coupon.direct_bonus}}{{coupon.symbol}} / Utilisé: {{coupon.pay_bonus}}{{coupon.symbol}}</span>-->
        <!--</p>-->
        <p matLine style="font-size: x-small;margin-top:3px;" *ngIf="coupon.tags.length>0">
          <span>#{{coupon.tags.replace(',',' #').replace(',',' #').replace(',',' #')}}</span>
        </p>
        <button style="display: inline-block;"
                *ngIf="canDelete"
                mat-flat-button mat-icon-button (click)="deleteCoupon(coupon)">
          <mat-icon>delete</mat-icon></button>
        &nbsp;
      </mat-list-item>
    </mat-list>
  </mat-card-content>
</mat-card>

