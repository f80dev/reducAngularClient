<mat-card class="app-card" style="padding:5px;background-color: #8f8f8f;">
  <mat-card-title>{{title}}</mat-card-title>
  <button mat-button mat-flat-button
          class="large-button"
          id="btnShowModels"
          *ngIf="!showOldCoupon"
          (click)="showOldCoupon=true">
    Utiliser un modèle
  </button>

  <mat-card-content class="app-card-content" style="text-align: left;margin:5px;">

    <app-old-coupons *ngIf="showOldCoupon"
                     title="Selectionnez un modèle"
                     [shop]="{'_id':coupon.shop,'owner':coupon.owner}"
                     [filter]="tags"
                     (cancel)="showOldCoupon=false"
                     (select)="selectOldAsModel($event)"></app-old-coupons>

    <mat-vertical-stepper style="background: none;margin:0px;padding:0px">
      <mat-step>
        <ng-template matStepLabel>Nature de la promotion</ng-template>

        <app-tuto label="Vous pouvez utiliser des emojis pour représenter l'unité de votre promo (par exemple pour 'croissant')"
                  [delay]="5">
        </app-tuto>

        <mat-form-field class="form-field-style">
          <input type="text" matInput
                 id="txtTitle"
                 autofocus
                 placeholder="Titre de la promotion (non visible du client)"
                 [(ngModel)]="coupon.title">
        </mat-form-field>


        <mat-form-field class="form-field-style" style="width: 60%;margin-right: 5%;">
          <input type="text" matInput
                 id="txtUnity"
                 placeholder="Que gagne-t-on ?"
                 [(ngModel)]="coupon.unity">
        </mat-form-field>

        <mat-form-field class="form-field-style" style="width: 30%;">
          <input type="text" matInput max="3"
                 id="txtSymbol"
                 placeholder="Symbole de l'unité"
                 [(ngModel)]="coupon.symbol">
        </mat-form-field>

        <!--<mat-checkbox style="width: 20%;margin-right: 5%;" [(ngModel)]="coupon.breakable">Sécable</mat-checkbox>-->
        <!--<mat-checkbox style="width: 20%;margin-right: 5%;" [(ngModel)]="coupon.pluriel">avec une 's' au pluriel</mat-checkbox>-->
      </mat-step>




      <mat-step>
        <ng-template matStepLabel>Teaser</ng-template>

        <mat-form-field class="form-field-style">
          <input type="text" matInput
                 id="txtLabel"
                 title="Préciser une description de la promotion"
                 placeholder="Teasing de la promotion" [(ngModel)]="coupon.label">
        </mat-form-field>


        <!--Gestion du visuel-->

        <app-tuto label="Il est bon d'ajouter un visuel pour renforcer l'attractivité de votre promotion. Cela peut être une photo ou un emoji"></app-tuto>

        <div style="width: 100%;text-align: center;">

          <button mat-flat-button
                  *ngIf="!deviceService.isDesktop()"
                  mat-button (click)="addEmoji()">Emojis</button>

          <button mat-flat-button mat-button
                  *ngIf="deviceService.isDesktop()"
                  (click)="showIcons=!showIcons;addIcons();">Emojis</button>
          &nbsp;&nbsp;

          <button mat-flat-button mat-button
                  id="cmdFile"
                  style="width:70px;text-align: center;">
            <label for="file">Photos</label>
            <input type="file" id="file" style="opacity: 0;"
                   (change)="onSelectFile($event)"
                   accept="image/gif,image/jpeg,image/png" />
          </button>

          <br><br>

          <div *ngIf="showIcons" style="width:100%;">
            <img *ngFor="let icon of icons" [src]="icon.photo"
                 style="width:30px;display: inline-block;"
                 (click)="selIcon(icon)">
          </div>

          <app-visual [picture]="preview"></app-visual>
        </div>

      </mat-step>


      <mat-step>
        <ng-template matStepLabel>Gains pour les clients</ng-template>
        <div style="font-size: x-small">
        le client gagne {{coupon.direct_bonus}} {{coupon.symbol}}
        lorsqu'il flash le coupon, puis
        {{coupon.share_bonus}} {{coupon.symbol}} supplémentaires pour chaque partage de la promo, et {{coupon.pay_bonus}} {{coupon.symbol}} si un client fait un achat avec.
        </div>
        <br>

        <mat-form-field class="form-field-style" style="width: 40%;margin-right: 10%;">
          <input matInput type="number"
                 id="txtDirectBonus"
                 title="Promotion directement récupéré à l'obtention du coupon"
                 placeholder="Bonus immédiat" [(ngModel)]="coupon.direct_bonus">
        </mat-form-field>


        <mat-form-field class="form-field-style" style="width: 40%">
          <input matInput type="number"
                 id="txtShareBonus" title="Bonus récupérer à chaque ouverture du coupon partagé"
                 placeholder="Bonus pour partage" [(ngModel)]="coupon.share_bonus">
        </mat-form-field>
        <app-tuto type="tips"
                  label="Attention, le bonus a chaque partagee doit resté faible car il peut augmenter rapidement sans pour autant générer de chiffres d'affaires">
        </app-tuto>


        <br>
        <mat-form-field class="form-field-style">
          <input matInput type="number"
                 id="txtPayBonus" title="Bonus obtenu lorsqu'un coupon partagé est utilisé chez le commercant"
                 placeholder="Bonus par achat obtenu par vos partages" [(ngModel)]="coupon.pay_bonus">
        </mat-form-field>
      </mat-step>

      <mat-step>
        <ng-template matStepLabel>Conditions d'application de l'offre</ng-template>

        <div style="font-size: x-small">
        Un client ne peut gagner plus de {{coupon.max}} {{coupon.unity}}<span *ngIf="coupon.pluriel && coupon.max>1">s</span>
        à chaque achat.<br>
          Offre valable pour {{coupon.conditions}}
        </div>
        <br>

        <mat-form-field class="form-field-style">
          <input matInput type="number"
                 id="txtMaxGainByUser" title="Gain maximum cumulable par coupon"
                 placeholder="Gain maximum pour coupon" [(ngModel)]="coupon.max">
        </mat-form-field>

        <mat-form-field class="form-field-style">
          <textarea matInput rows="3"
                    id="txtConditions"
                    title="Condition d'application de l'offre / de la promo"
                    placeholder="Offre valable pour ..."
                    [(ngModel)]="coupon.conditions"
                    (change)="normalize_conditions(coupon)"></textarea>
        </mat-form-field>

        <app-tuto label="Les conditions seront présentées précédées de la phrase 'valable pour'. Il ne faut donc pas mettre ces mots au début des conditions rédigées">

        </app-tuto>


      </mat-step>


      <mat-step  name="step5">
        <ng-template matStepLabel>Limites globales</ng-template>

        <app-tuto label="Plusieurs limites vous permette de maitriser la promotion en terme de coût, de stock, de durée de validité">
        </app-tuto>


        <div style="font-size: x-small">
          La promotion dure <span *ngIf="coupon.duration_jours!=null && coupon.duration_jours>0">{{coupon.duration_jours}} jour(s) et</span>
          <span *ngIf="coupon.duration_hours!=null && coupon.duration_hours>0">{{coupon.duration_hours}} heures</span>,
        et s'interrompt si les {{coupon.stock}} {{coupon.symbol}} ont été distribué(es)
          ou si plus de {{coupon.max_coupon}} promotions ont été partagées.
        <br><br>
        </div>

        <mat-form-field class="form-field-style" style="width: 40%;margin-right:10%;">
          <input matInput id="txtDays"
                 type="number" min="0" step="any"  placeholder="Durée (En Jours)" [(ngModel)]="coupon.duration_jours">
        </mat-form-field>

        <mat-form-field class="form-field-style" style="width: 40%;">
          <input matInput id="txtHours" type="number" min="0" step="any" placeholder="Durée (En Heure)" [(ngModel)]="coupon.duration_hours">
        </mat-form-field>
        <br>

        <mat-form-field class="form-field-style">
          <input matInput type="number"
                 id="txtStock"
                 placeholder="Stock (en {{coupon.symbol}}) destiné à la promotion" [(ngModel)]="coupon.stock">
        </mat-form-field>

        <mat-form-field class="form-field-style">
          <input matInput type="number"
                 id="txtMaxShare"
                 placeholder="Nombre maximum de partages" [(ngModel)]="coupon.max_coupon">
        </mat-form-field>

      </mat-step>


    </mat-vertical-stepper>
  </mat-card-content>

  <mat-card-actions class="app-card-action">
    <button mat-flat-button class="app-button"
            id="btnValide"
            *ngIf="coupon.label?.length>0 && coupon.title?.length>0" mat-button
            (click)="addcoupon(coupon)">Valide</button>

    <button mat-flat-button
            id="btnCancel"
            class="app-button"
            mat-button (click)="cancel()">Annuler</button>
    &nbsp;&nbsp;&nbsp;<br><br>
  </mat-card-actions>
</mat-card>


