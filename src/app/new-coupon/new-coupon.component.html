<mat-card class="app-card" style="padding:5px;">
  <mat-card-title>Nouvelle Promotion</mat-card-title>
  <button mat-button mat-flat-button
          *ngIf="!showOldCoupon"
          (click)="showOldCoupon=true">Modèles</button>

  <mat-card-content class="app-card-content" style="text-align: left;margin:0px;padding:0px;">

    <app-old-coupons *ngIf="showOldCoupon"
                     title="Selectionnez un modèle"
                     [shop]="shop"
                     (select)="selectOldAsModel($event)"></app-old-coupons>
    <br>

    <mat-vertical-stepper style="background: none;margin:0px;padding:0px">
      <mat-step>
        <ng-template matStepLabel>Nature de la promotion</ng-template>



        <mat-form-field class="form-field-style" *ngIf="shopNameEdit">
          <input type="text" matInput placeholder="Nom de la boutique" [(ngModel)]="coupon.shop">
        </mat-form-field>

        <app-tuto label="Vous pouvez utiliser des emojis pour représenter l'unité de votre promo (par exemple pour 'croissant')"
                  [delay]="5">
        </app-tuto>

        <mat-form-field class="form-field-style">
          <input type="text" matInput
                 placeholder="Titre de la promotion (non visible du client)"
                 [(ngModel)]="coupon.title">
        </mat-form-field>


        <mat-form-field class="form-field-style" style="width: 60%;margin-right: 10%;">
          <input type="text" matInput

                 placeholder="Que gagne-t-on ?"
                 [(ngModel)]="coupon.unity">
        </mat-form-field>

        <mat-form-field class="form-field-style" style="width: 20%;">
          <input type="text" matInput max="3"
                 placeholder="Symbole"
                 [(ngModel)]="coupon.symbol">
        </mat-form-field>

        <br><br>

        <mat-checkbox style="width: 20%;margin-right: 5%;" [(ngModel)]="coupon.breakable">Sécable</mat-checkbox>
        <mat-checkbox style="width: 20%;margin-right: 5%;" [(ngModel)]="coupon.pluriel">avec une 's' au pluriel</mat-checkbox>
      </mat-step>




      <mat-step>
        <ng-template matStepLabel>Teaser</ng-template>

        <mat-form-field class="form-field-style">
          <input type="text" matInput placeholder="Teasing de la promotion" [(ngModel)]="coupon.label">
        </mat-form-field>


        <!--Gestion du visuel-->
        <div style="width: 100%;text-align: center;">

          <button mat-flat-button mat-button (click)="showIcons=!showIcons;addIcons();">Icones</button>
          &nbsp;&nbsp;

          <button mat-flat-button mat-button style="width:70px;text-align: center;">
            <label for="file">Photos</label>
            <input type="file" id="file" style="opacity: 0;"
                   (change)="onSelectFile($event)"
                   accept="image/gif,image/jpeg,image/png" />
          </button>

          <br><br>

          <div *ngIf="showIcons" style="width:100%;">
            <img *ngFor="let icon of icons" [src]="icon.photo"
                 style="width:30px;display: inline-block;"
                 (click)="selIcon(icon)">
          </div>

          <img style="max-height:200px"
               *ngIf="preview?.length>0"
               [src]="preview">
        </div>

      </mat-step>


      <mat-step>
        <ng-template matStepLabel>Gains pour les clients</ng-template>
        <div style="font-size: x-small">
        le client gagne {{coupon.direct_bonus}} {{coupon.symbol}}
        lorsqu'il flash le coupon, puis
        {{coupon.share_bonus}} {{coupon.symbol}} supplémentaires pour chaque partage de la promo, et {{coupon.pay_bonus}} {{coupon.symbol}} si un client fait un achat avec.
        </div>
        <br>

        <mat-form-field class="form-field-style" style="width: 40%;margin-right: 10%;">
          <input matInput type="number" placeholder="Bonus immédiat" [(ngModel)]="coupon.direct_bonus">
        </mat-form-field>


        <mat-form-field class="form-field-style" style="width: 40%">
          <input matInput type="number" placeholder="Bonus pour partage" [(ngModel)]="coupon.share_bonus">
        </mat-form-field>
        <app-tuto type="tips"
                  label="Attention, le bonus a chaque partagee doit resté faible car il peut augmenter rapidement sans pour autant générer de chiffres d'affaires">
        </app-tuto>


        <br>
        <mat-form-field class="form-field-style">
          <input matInput type="number" placeholder="Bonus par achat obtenu par vos partages" [(ngModel)]="coupon.pay_bonus">
        </mat-form-field>



      </mat-step>

      <mat-step>
        <ng-template matStepLabel>Conditions d'application</ng-template>

        <div style="font-size: x-small">
        Un client ne peut gagner plus de {{coupon.max}} {{coupon.unity}}<span *ngIf="coupon.pluriel && coupon.max>1">s</span>
        à chaque achat<br>
        </div>
        <br>

        <mat-form-field class="form-field-style">
          <input matInput type="number" placeholder="Gain maximum pour le client" [(ngModel)]="coupon.max">
        </mat-form-field>

        <mat-form-field class="form-field-style">
          <textarea matInput rows="3" placeholder="Condition d'obtention de la promotion" [(ngModel)]="coupon.conditions"></textarea>
        </mat-form-field>


      </mat-step>


      <mat-step>
        <ng-template matStepLabel>Limites globales</ng-template>

        <div style="font-size: x-small">
          La promotion dure <span *ngIf="coupon.duration_jours!=null && coupon.duration_jours>0">{{coupon.duration_jours}} jour(s) et</span>
          <span *ngIf="coupon.duration_hours!=null && coupon.duration_hours>0">{{coupon.duration_hours}} heures</span>,
        et s'interrompt si les {{coupon.stock}} {{coupon.symbol}} ont été distribué(es)
          ou si plus de {{coupon.max_coupon}} promotions ont été partagées.
        <br><br>
        </div>

        <mat-form-field class="form-field-style" style="width: 40%;margin-right:10%;">
          <input matInput type="number" min="0" step="any"  placeholder="Durée (En Jours)" [(ngModel)]="coupon.duration_jours">
        </mat-form-field>

        <mat-form-field class="form-field-style" style="width: 40%;">
          <input matInput type="number" min="0" step="any" placeholder="Durée (En Heure)" [(ngModel)]="coupon.duration_hours">
        </mat-form-field>
        <br>

        <mat-form-field class="form-field-style">
          <input matInput type="number" placeholder="Stock (en {{coupon.symbol}}) destiné à la promotion" [(ngModel)]="coupon.stock">
        </mat-form-field>

        <mat-form-field class="form-field-style">
          <input matInput type="number" placeholder="Nombre maximum de partages" [(ngModel)]="coupon.max_coupon">
        </mat-form-field>

      </mat-step>


    </mat-vertical-stepper>
  </mat-card-content>

  <mat-card-actions>
    <button mat-flat-button class="app-button"
            *ngIf="coupon.label?.length>0" mat-button
            (click)="addcoupon(coupon)">Valide</button>

    <button mat-flat-button class="app-button"
            mat-button (click)="onclose.emit()">Annuler</button>
    <br><br>
  </mat-card-actions>
</mat-card>


