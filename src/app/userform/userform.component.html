<mat-expansion-panel class="app-card" [expanded]="true" style="margin-bottom: 3px;margin-top: 2px;">
    <mat-expansion-panel-header class="app-card-header" collapsedHeight="80px" expandedHeight="80px">
      <div *ngIf="!showPersonalCode" style="display:inline-block;width:90px;vertical-align: middle;position:relative;">
        <app-visual width="70px" height="70px" [picture]="user.photo" (click)="addImage($event)"></app-visual>
      </div>

      <qr-code [size]="70"
               style="display: inline-block;vertical-align: middle;margin-right: 20px;"
               *ngIf="showPersonalCode"
               title="Le QRCode permet d'identifier l'utilisateur notamment pour la délégation de gestion"
               ngxClipboard
               [cbContent]="user._id"
               [value]="user._id">
      </qr-code>


      <div style="display: inline-block;margin-top:15px;font-size: x-large;">
        <span *ngIf="user.pseudo?.length>0" (click)="promptForPseudo($event)">{{user.pseudo}}</span>
        <span *ngIf="user.pseudo?.length==0" (click)="promptForPseudo($event)">Pseudo ?</span>
      </div>

      <!--<button *ngIf="user.pseudo?.length==0" style="display: inline-block;"-->
              <!--id="cmdPseudo" class="medium-button"-->
              <!--title="Il est possible de modifier son pseudo tout en restant anonyme"-->
              <!--mat-button mat-flat-button-->
              <!--(click)="promptForPseudo()">-->
        <!--Pseudo-->
      <!--</button>-->

      <!--<button mat-button *ngIf="user.level==0"-->
              <!--id="btnAddShop" class="mediyum-button" style="display: inline-block;margin-left:5px;"-->
              <!--mat-raised-button (click)="addshop()">-->
      <!--<span *ngIf="user.shops==null || user.shops.length==0">-->
        <!--Nvlle promotion-->
      <!--</span>--
        <!--<span *ngIf="user.shops?.length>0">-->
        <!--Nvlle enseigne-->
      <!--</span>-->
      <!--</button>-->

      <mat-progress-spinner *ngIf="config.waiting"></mat-progress-spinner>

    </mat-expansion-panel-header>

    <div *ngIf="user.message?.length>0"
         [innerHTML]="user.message.split('#submessage#')[0] | safe:'html'">
    </div>

  <div class="app-card-content">
    <div style="width:100%;text-align: center;" *ngIf="showScanner">
      <app-scanner [size]="400"
                   filter="/home"
                   (flash)="onflash_event($event)">
      </app-scanner>
    </div>

    <!--Montre la carte des promotions-->
    <div *ngIf="showMap">
      <mat-form-field *ngIf="showCouponOnMap?.length>=5 || filter_tag?.length>0" style="width:60%;">
        <mat-label>Voir la categorie:</mat-label>
        <mat-select [(value)]="filter_tag" (selectionChange)="showPromoInSquare()">
          <mat-option *ngFor="let tag of config.values.tags.split(',')" [value]="tag">
            #{{tag}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <button  mat-icon-button mat-button *ngIf="filter_tag?.length>0" (click)="filter_tag='';showPromoInSquare();">
        <mat-icon>close</mat-icon>
      </button>


      <div id="map" class="map" style="width:95%;display: inline-block;"></div>
      <br>
      <app-list-coupons *ngIf="showCouponOnMap"
                        [user]="user"
                        (flash)="flash()"
                        [coupons]="showCouponOnMap">
      </app-list-coupons>
    </div>

    <!--<app-old-coupons [user]="user"-->
                     <!--*ngIf="showOldPromos">-->
    <!--</app-old-coupons>-->

    <app-tuto button="map" *ngIf="user.coupons?.length==0 && user.level>0.3 && user.shops?.length==0"
              label="Voir les promotions autour de vous sur une carte">
    </app-tuto>

    <app-tuto *ngIf="user.level>0 && user.shops?.length==0" button="account_balance"
              label="Vous avez quelque chose à vendre ? Créer votre première promotion !">
    </app-tuto>

    <app-tuto [delay]="10" button="build" *ngIf="user.level>0.6 && user.level<1"
              label="Vous êtes un habitué de reducshare ? Passer l'interface en mode avancée">
    </app-tuto>

    <app-tuto [delay]="8" button="camera_alt" *ngIf="user.level>0.2 && config.webcamsAvailable>0"
              label="Vous pouvez flasher les QRCodes de promotion directement depuis reducshare">
    </app-tuto>


    <app-tuto button="delete" *ngIf="user.level==1 && (user.shops?.length==0)"
              label="Si vous n'avez plus de promotion en cours, vous pouvez totalement effacer votre compte de reducShare">
    </app-tuto>


  </div>
  <mat-action-row class="app-card-action">
    <!--<button mat-button mat-raised-button (click)="showOldPromos=!showOldPromos">Mes promos</button>-->

    <button mat-icon-button
            *ngIf="user.email?.indexOf('fictif.com')>-1"
            title="S'authentifier permet de se connecter depuis plusieurs appareils"
            id="btnEmailLogin"
            mat-button mat-flat-button (click)="securise()">
      <mat-icon>verified_user</mat-icon>
    </button>


    <button mat-icon-button mat-raised-button
            style="margin-left:10px;"
            *ngIf="user.email?.indexOf('fictif.com')==-1"
            id="btnLogout"
            mat-button (click)="logout()">
      <mat-icon>logout</mat-icon>
    </button>


    <button mat-icon-button mat-button mat-raised-button
            *ngIf="(user.shops==null || user.shops.length==0) && user.level>0.5"
            id="btnRAZ"
            (click)="clearAccount(user._id)">
      <mat-icon>delete</mat-icon>
    </button>

    <button mat-button
            *ngIf="user.level>0.8"
            id="btnShowCode" title="Afficher son qrcode personnel"
            mat-raised-button mat-icon-button
            (click)="showPersonalCode=!showPersonalCode">
      <mat-icon>tap_and_play</mat-icon>
    </button>

    <button *ngIf="config.webcamsAvailable>0" mat-button
            id="btnScan"
            title="Scanner des coupons directement depuis l'application"
            mat-raised-button mat-icon-button (click)="startScanner()">
      <mat-icon>camera_alt</mat-icon>
    </button>

    <button mat-button
            *ngIf="user.level<3"
            id="btnExpert" title="Accès aux fonctions avancées de ReducShare"
            mat-raised-button mat-icon-button (click)="upgradeLevel()">
      <mat-icon>build</mat-icon>
    </button>

    <button mat-button *ngIf="user.level>0.5"
            id="btnNotif" title="Recevoir des notifications sur ses appareils connectés (utilisateurs avancés)"
            mat-raised-button mat-icon-button (click)="setWebhook()">
      <mat-icon>notifications_active</mat-icon>
    </button>
    <button mat-raised-button mat-icon-button mat-button
            *ngIf="user.level>=0.8 || user.shops?.length>0"
            id="btnMap" title="Voir les promos autour de soit (nécéssite de partager sa position)"
            (click)="openLoc()">
      <mat-icon>map</mat-icon>
    </button>

    <button mat-raised-button mat-button
            *ngIf="user.level<0.8 && user.shops?.length==0"
            id="btnMapRookie"
            title="Voir les promos autour de soit (nécéssite de partager sa position)"
            (click)="openLoc()">
      Promos proches
    </button>


    <button mat-button
            *ngIf="user.tags?.length==0 || user.shops?.length>0"
            title="Créer un nouveau point de vente"
            id="btnAddShopPlus" mat-icon-button
            mat-raised-button (click)="addshop()">
      <mat-icon>account_balance</mat-icon>
    </button>

    <button mat-button
            *ngIf="user.coupons?.length>2"
            title="Trier vos coupons"
            id="btnSort" mat-icon-button
            mat-raised-button (click)="sortCoupons()">
      <mat-icon>sort</mat-icon>
    </button>


    <button mat-button
            *ngIf="user.tags?.length>0 && user.shops?.length==0"
            title="Créer une nouvelle enseigne pour des promotions"
            id="btnAddShopPlus2"
            mat-raised-button (click)="addshop()">
      Lancer une promotion
    </button>

  </mat-action-row>
</mat-expansion-panel>
