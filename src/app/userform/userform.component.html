<mat-card class="app-card">
  <mat-card-header>
    <mat-card-title>
      <div style="display:inline-block;width:100px;vertical-align: middle;">
        <label for="file_profil"><img mat-card-avatar style="width:70px;height:70px;" [src]="user.photo"></label>
        <input style="display:none;width:50px;" type="file" id="file_profil"
               (change)="onSelectFile($event)"
               accept="image/gif,image/jpeg,image/png" />

      </div>
      <span *ngIf="!user.email?.endsWith('fictif.com')">{{user.email}}</span>
      <span *ngIf="user.pseudo?.length>0" (click)="promptForPseudo()">{{user.pseudo}}</span>

      <button *ngIf="user.pseudo?.length==0"
              id="cmdPseudo" class="large-button"
              mat-button mat-flat-button (click)="promptForPseudo()">
        Pseudo ?
      </button>

      <span class="spacer"></span>
      <mat-progress-spinner *ngIf="config.waiting"></mat-progress-spinner>

    </mat-card-title>

    <mat-card-subtitle *ngIf="user.message?.length>0">{{user.message}}</mat-card-subtitle>
    <app-tuto label="Cette zone affiche les informations de votre profil"></app-tuto>
  </mat-card-header>
  <mat-card-content class="app-card-content">
    <div style="width:100%;text-align: center;" *ngIf="showScanner">
      <webcam
              [height]="400" [width]="400"
              [trigger]="triggerObservable"
              [allowCameraSwitch]="false"
              [imageQuality]="0.85"
              [captureImageData]="true"
              imageType="image/jpeg"
              (imageCapture)="handleImage($event)">
      </webcam>
    </div>

    <!--Montre la carte des promotions-->
    <div *ngIf="showMap">
      <div id="map" class="map" style="width:95%;display: inline-block;"></div>
      <br>
      <app-list-coupons *ngIf="showCouponOnMap"
                        [user]="user"
                        (flash)="flash($event)"
                        [coupons]="showCouponOnMap">
      </app-list-coupons>
    </div>

    <app-old-coupons [user]="user"
                     *ngIf="showOldPromos">
    </app-old-coupons>

    <app-tuto [delay]="1" icon="map"
              label="Vous pouvez voir les promos autour de vous en activant la carte">
    </app-tuto>

    <app-tuto [delay]="6"
              label="Si vous pensez utiliser souvent cette appli, enregistrez la directement sur votre bureau via l'option adéquate du menu de votre navigateur">
    </app-tuto>

    <app-tuto [delay]="2" icon="camera_alt" [if]="webcamsAvailable>0"
              label="Vous pouvez flasher les QRCodes de promotion directement depuis reducshare">
    </app-tuto>


    <app-tuto [delay]="6" icon="delete" [if]="user.level>0 && (user.shops==null || user.shops.length==0)"
              label="Si vous n'avez plus de promotion en cours, vous pouvez totalement effacer votre compte de reducShare">
    </app-tuto>


  </mat-card-content>
  <mat-card-actions class="app-card-action">
    <!--<button mat-button mat-raised-button (click)="showOldPromos=!showOldPromos">Mes promos</button>-->

    <button mat-icon-button mat-button mat-raised-button
            *ngIf="(user.shops==null || user.shops.length==0) && user.level>0"
            id="btnRAZ"
            (click)="clearAccount(user._id)">
      <mat-icon>delete</mat-icon>
    </button>

    <button *ngIf="webcamsAvailable>0" mat-button
            id="btnScan" title="Scanner des coupons directement depuis l'application"
            mat-raised-button mat-icon-button (click)="startScanner()">
      <mat-icon>camera_alt</mat-icon>
    </button>

    <button *ngIf="user.level==0" mat-button
            id="btnExpert" title="Simplifier l'interface pour les utilisateurs habitués"
            mat-raised-button mat-icon-button (click)="upgradeLevel()">
      <mat-icon>build</mat-icon>
    </button>

    <button mat-button *ngIf="user.level>0"
            id="btnNotif" title="Recevoir des notifications sur ses appareils connectés (utilisateurs avancés)"
            mat-raised-button mat-icon-button (click)="setWebhook()">
      <mat-icon>notifications</mat-icon>
    </button>
    <button mat-icon-button mat-button
            id="btnMap" title="Voir les promos autour de soit (nécéssite de partager sa position)"
            mat-raised-button (click)="openLoc()">
      <mat-icon>map</mat-icon>
    </button>
    <button mat-button *ngIf="user.level>0"
            id="btnAddShopPlus" mat-icon-button
            mat-raised-button (click)="addshop()">
      <mat-icon >add_shopping_cart</mat-icon>
    </button>

    <button mat-button *ngIf="user.level==0"
            id="btnAddShop" class="large-button"
            mat-raised-button (click)="addshop()">
      <span *ngIf="user.shops==null || user.shops.length==0">
        Votre promotion
      </span>
      <span *ngIf="user.shops?.length>0">
        Nouvelle enseigne
      </span>

    </button>
  </mat-card-actions>
</mat-card>
