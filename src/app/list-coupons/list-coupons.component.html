<mat-card *ngFor="let coupon of coupons" class="app-card">
  <mat-card-header (click)="showCoupon(coupon)">
    <div mat-card-avatar class="header-image"></div>
    <mat-card-title style="font-size: medium;">
      <div *ngIf="coupon.origin!=coupon._id">
      <span *ngIf="!isVisible(coupon)">
          <strong>{{coupon.gain}}</strong>{{coupon.symbol}} - {{coupon.shop_complete.name}}
      </span>
        <span *ngIf="isVisible(coupon)">
        {{coupon.shop_complete.name}}: {{coupon.label}}
      </span>
      </div>
      <div *ngIf="coupon.origin==coupon._id">
        {{coupon.title}} - <app-timer [end]="coupon.dtEnd"></app-timer>
      </div>

    </mat-card-title>

    <mat-card-subtitle *ngIf="!isVisible(coupon)">
      <span *ngIf="!isVisible(coupon) && coupon.origin!=coupon._id">
        {{coupon.label}}
      </span>

      <div *ngIf="coupon._id==coupon.origin">

             {{coupon.share}}/{{coupon.max_coupon}} coupons distribués


        <span *ngIf="(coupon.gain/coupon.max)>0.8">
          (max:{{coupon.max}})
        </span>

      </div>

    </mat-card-subtitle>
  </mat-card-header>

  <mat-card-content class="app-card-content" *ngIf="isVisible(coupon)">

    <app-tuto [delay]="20" label="Cliquer sur le titre pour réduire la taille d'affichage du coupon"></app-tuto>

    <!-- Section destinée à l'imprression -->
    <div name="print-section" style="display: none;">
      <app-print-coupon [coupon]="coupon"></app-print-coupon>
    </div>

    <!--Visuel du coupon-->
    <table style="width:100%;vertical-align: top;text-align: center;"><tr>
      <td style="text-align: center;width: fit-content;max-width: 40%;">
        <!--Visuel du coupon-->

        <div *ngIf="(coupon.showCode==null || !coupon.showCode) && coupon.picture?.length>0">

          <img
            *ngIf="coupon.origin!=coupon._id"
            [src]="coupon.picture"
            style="width: 130px;height:130px;display: inline-block;">

        </div>

        <!--QRCode du coupon-->

        <qr-code [value]="coupon.url"
                 style="max-width:200px;max-height: 200px;display:inline;"
                 *ngIf="coupon.showCode"
                 [size]="150">
        </qr-code>

        <!--Zone réserver au créateur-->
        <div *ngIf="coupon._id==coupon.origin && coupon.share>0" style="font-size: small;">
          {{coupon.share | number:'1.0-0'}}/{{coupon.max_coupon}} partages<br>
          {{coupon.gain_total | number:'1.0-0'}} {{coupon.symbol}} distribué(es) <br><br>
          Stock : {{coupon.stock | number:'1.0-1'}} {{coupon.symbol}}
        </div>


      </td>
      <td style="text-align: center;vertical-align: top;width:auto;">
        <div style="display:inline-block;font-size: larger;" *ngIf="coupon._id!=coupon.origin">
          Vous avez gagné {{coupon.gain}}{{coupon.symbol}}
          <span *ngIf="coupon.gain/coupon.max>0.8">(/{{coupon.max}})</span>
        </div>
        <br><br>

        <table style="text-align: left;display: inline-block;font-size:small;"
               cellpadding="2"
               *ngIf="coupon.canbedeal">
          <tr><td>Partage</td><td>+{{coupon.share_bonus}}{{coupon.symbol}}</td></tr>
          <tr><td>Achat</td><td>+{{coupon.pay_bonus}}{{coupon.symbol}}</td></tr>
          <tr><td>Immédiat</td><td>+{{coupon.direct_bonus}}{{coupon.symbol}}</td></tr>
        </table><br><br>
        <span style="font-size: small">
            Reste <app-timer [end]="coupon.dtEnd"></app-timer>
          </span>



      </td>
    </tr></table>


    <app-tuto [if]="coupon.showCode && isVisible(coupon)" [delay]="1" [duration]="15"
              label="Le lien du coupon est disponible dans le presse-papier, vous pouvez l'envoyer par WhatsApp, SMS, Messenger ... etc ...">
    </app-tuto>

    <app-tuto icon="share" [delay]="2" [duration]="15" [if]="coupon.canbedeal"
              label="Augmenter votre réduction en partageant cette réduction avec votre réseau">
    </app-tuto>

    <div style="width: 100%;text-align: center;font-size: x-small;color:lightgrey;" *ngIf="coupon.origin!=coupon._id && coupon.showCode">
      <br>
      <strong>Conditions d'application:</strong><br>
      {{coupon.conditions}}
    </div>


  </mat-card-content>

  <!--Info sur le coupon-->

  <mat-card-actions style="text-align: center;" *ngIf="isVisible(coupon)">

    <div *ngIf="!coupon.closed" style="display: inline-block;">
      <button mat-button mat-flat-button
              *ngIf="coupon.canbedeal || coupon.origin!=coupon._id"
              title="Partager le coupon pour augmenter votre promotion / réduction"
              (click)="showCode(coupon)"
              ngxClipboard [cbContent]="coupon.url">
          <span *ngIf="coupon.canbedeal">
            Partager
          </span>

        <span *ngIf="!coupon.canbedeal">
            Utiliser
          </span>

      </button>

      <!--<button mat-button mat-flat-button-->
      <!--mat-icon-button (click)="socialSharing(coupon)" >-->
      <!--<span style="font-size: x-large">f</span>-->
      <!--</button>-->

      <!--<button mat-button mat-flat-button-->
      <!--mat-icon-button (click)="socialSharing(coupon)" >-->
      <!--<span style="font-size: large">g+</span>-->
      <!--</button>-->

    </div>
    &nbsp;


    <!--<button mat-button mat-flat-button mat-icon-button (click)="showInfos(coupon)">-->
    <!--<mat-icon>attach_money</mat-icon>-->
    <!--</button>-->

    <button *ngIf="coupon._id==coupon.origin && isVisible(coupon) && coupon.canbedeal" mat-button
            (click)="openPrinter(coupon)"
            title="Imprimer une affiche de votre bon plan"
            mat-flat-button mat-icon-button>
      <mat-icon>printer</mat-icon>
    </button>

    <button *ngIf="coupon.shop.owner!=user?._id" mat-button
            (click)="addfollow(user._id,coupon.shop)"
            title="Recevoir les prochaines promotion de '{{coupon.shop_complete?.name}}'"
            mat-flat-button mat-icon-button>
      <mat-icon>link</mat-icon>
    </button>

    <button *ngIf="coupon._id==coupon.origin && isVisible(coupon) && coupon.canbedeal" mat-button
            (click)="stopDeal(coupon)"
            title="Fermer prématurément la promotion"
            mat-flat-button mat-icon-button>
      <mat-icon>cancel</mat-icon>
    </button>

    <button mat-button mat-flat-button
            *ngIf="coupon._id!=coupon.origin"
            title="Localiser l'enseigne proposant la réduction"
            mat-icon-button  (click)="showAddress(coupon.shop_complete)">
      <mat-icon>map</mat-icon>
    </button>

    <button mat-button mat-flat-button
            mat-icon-button
            (click)="remove(coupon)">
      <mat-icon>delete</mat-icon>
    </button>
  </mat-card-actions>
</mat-card>
<br>
